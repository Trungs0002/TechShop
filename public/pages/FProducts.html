<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách sản phẩm</title>
</head>
<body>
    <h1>Danh sách sản phẩm</h1>

    <!-- Form tìm kiếm sản phẩm -->
    <form id="searchForm">
        <input type="text" id="searchName" placeholder="Tên sản phẩm">
        <input type="number" id="searchPrice" placeholder="Giá tối đa">
        <input type="text" id="searchBrand" placeholder="Thương hiệu">
        <input type="text" id="searchWarranty" placeholder="Bảo hành">
        <button type="submit">Tìm kiếm</button>
        <button type="button" id="refresh-btn">Làm mới danh sách</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Tên sản phẩm</th>
                <th>Giá</th>
                <th>Thương hiệu</th>
                <th>Bảo hành</th>
            </tr>
        </thead>
        <tbody id="product-list">
            <!-- Danh sách sản phẩm sẽ hiển thị ở đây -->
        </tbody>
    </table>

    <script>
        let products = []; // Lưu dữ liệu sản phẩm để tìm kiếm cục bộ

        // Hàm lấy dữ liệu từ API
        function loadProducts(query = '') {
            fetch(`/api/sanpham${query}`)
                .then(response => response.json())
                .then(data => {
                    products = data; // Lưu danh sách để tìm kiếm nhanh
                    renderProducts(products);
                })
                .catch(error => console.error('Lỗi khi tải danh sách sản phẩm:', error));
        }

        // Hàm hiển thị danh sách sản phẩm
        function renderProducts(filteredProducts) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = ''; // Xóa danh sách cũ
            
            filteredProducts.forEach(sp => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sp.id}</td>
                    <td>${sp.name}</td>
                    <td>${sp.price.toLocaleString()} VND</td>
                    <td>${sp.brand}</td>
                    <td>${sp.warranty}</td>
                `;
                productList.appendChild(row);
            });
        }

        // Hàm tìm kiếm theo từ đang gõ
        function liveSearch() {
            const name = document.getElementById('searchName').value.toLowerCase();
            const price = document.getElementById('searchPrice').value;
            const brand = document.getElementById('searchBrand').value.toLowerCase();
            const warranty = document.getElementById('searchWarranty').value.toLowerCase();

            const filtered = products.filter(sp => 
                (!name || sp.name.toLowerCase().includes(name)) &&
                (!price || sp.price <= parseFloat(price)) &&
                (!brand || sp.brand.toLowerCase().includes(brand)) &&
                (!warranty || sp.warranty.toLowerCase().includes(warranty))
            );

            renderProducts(filtered);
        }
         // Lọc ngay khi gõ vào ô tìm kiếm
        document.getElementById('searchName').addEventListener('input', liveSearch);
        document.getElementById('searchPrice').addEventListener('input', liveSearch);
        document.getElementById('searchBrand').addEventListener('input', liveSearch);
        document.getElementById('searchWarranty').addEventListener('input', liveSearch);

        // Gọi API để tải dữ liệu khi trang được mở
        loadProducts();

   

        // Xử lý sự kiện khi bấm nút "Tìm kiếm"
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Ngăn form gửi request mặc định

            const name = document.getElementById('searchName').value.trim();
            const price = document.getElementById('searchPrice').value;
            const brand = document.getElementById('searchBrand').value.trim();
            const warranty = document.getElementById('searchWarranty').value.trim();

            const query = new URLSearchParams({ name, price, brand, warranty }).toString();
            loadProducts(`/filter?${query}`);
        });

        // Xử lý nút "Làm mới danh sách"
        document.getElementById('refresh-btn').addEventListener('click', function () {
            document.getElementById('searchForm').reset(); // Reset form tìm kiếm
            renderProducts(products); // Hiển thị lại danh sách đầy đủ
        });
    </script>
</body>
</html>
